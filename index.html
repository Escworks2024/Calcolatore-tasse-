<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolo Regime Forfettario</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        input, select {
            width: 100%;
            box-sizing: border-box;
        }
        input:disabled {
            background-color: #f0f0f0;
            color: #a0a0a0;
        }
    </style>
</head>
<body>

<h2>Calcolo Regime Forfettario</h2>

<table>
    <thead>
        <tr>
            <th>Parametro</th>
            <th>Valore</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Fatturato (€)</td>
            <td><input type="number" id="fatturato" oninput="calcola()"></td>
        </tr>
        <tr>
            <td>Coefficiente di Redditività (%)</td>
            <td><input type="number" id="coefficiente-redditivita" value="40" oninput="calcola()"></td>
        </tr>
        <tr>
            <td>Tassazione (%)</td>
            <td><input type="number" id="tassazione" value="15" oninput="calcola()"></td>
        </tr>
        <tr>
            <td>Modalità INPS</td>
            <td>
                <select id="modalita-inps" onchange="aggiornaModalitaINPS()">
                    <option value="fisso">INPS Fisso (850 € ogni tre mesi)</option>
                    <option value="proporzione">INPS in Proporzione (24% del reddito imponibile)</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>Soglia INPS Eccedenza (€)</td>
            <td><input type="number" id="soglia-inps-eccedenza" value="15000" oninput="calcola()"></td>
        </tr>
        <tr>
            <td>Aliquota INPS Eccedenza (%)</td>
            <td><input type="number" id="aliquota-inps-eccedenza" value="25" oninput="calcola()"></td>
        </tr>
    </tbody>
</table>

<h3>Risultati</h3>
<table>
    <thead>
        <tr>
            <th>Descrizione</th>
            <th>Valore (€)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Reddito Imponibile</td>
            <td id="reddito-imponibile"></td>
        </tr>
        <tr>
            <td>Tasse</td>
            <td id="tasse"></td>
        </tr>
        <tr>
            <td>INPS</td>
            <td id="inps"></td>
        </tr>
        <tr>
            <td>INPS Eccedenza</td>
            <td id="inps-eccedenza"></td>
        </tr>
        <tr>
            <td>Reddito Netto</td>
            <td id="reddito-netto"></td>
        </tr>
    </tbody>
</table>

<script>
    function aggiornaModalitaINPS() {
        const modalitaInps = document.getElementById('modalita-inps').value;
        const aliquotaInpsEccedenzaInput = document.getElementById('aliquota-inps-eccedenza');

        if (modalitaInps === "fisso") {
            // Abilita il campo "Aliquota INPS Eccedenza"
            aliquotaInpsEccedenzaInput.disabled = false;
        } else if (modalitaInps === "proporzione") {
            // Disabilita il campo e resetta il valore
            aliquotaInpsEccedenzaInput.disabled = true;
            aliquotaInpsEccedenzaInput.value = 0;
        }

        // Ricalcola i risultati
        calcola();
    }

    function calcola() {
        // Recupera i valori inseriti dall'utente
        const fatturato = parseFloat(document.getElementById('fatturato').value) || 0;
        const coefficienteRedditivita = parseFloat(document.getElementById('coefficiente-redditivita').value) || 0;
        const tassazione = parseFloat(document.getElementById('tassazione').value) || 0;
        const modalitaInps = document.getElementById('modalita-inps').value;
        const sogliaInpsEccedenza = parseFloat(document.getElementById('soglia-inps-eccedenza').value) || 0;
        const aliquotaInpsEccedenza = parseFloat(document.getElementById('aliquota-inps-eccedenza').value) || 0;

        // Calcola il reddito imponibile
        const redditoImponibile = fatturato * (coefficienteRedditivita / 100);

        // Calcola le tasse
        const tasse = redditoImponibile * (tassazione / 100);

        // Calcola l'INPS in base alla modalità selezionata
        let inps;
        if (modalitaInps === "fisso") {
            // INPS fisso: 850 € ogni tre mesi (3.400 € all'anno)
            inps = 3400;
        } else if (modalitaInps === "proporzione") {
            // INPS in proporzione: 24% del reddito imponibile
            inps = redditoImponibile * 0.24;
        }

        // Calcola l'INPS eccedenza (solo se l'aliquota è abilitata)
        let inpsEccedenza = 0;
        if (!document.getElementById('aliquota-inps-eccedenza').disabled) {
            const redditoNettoPrimaDiINPS = redditoImponibile - tasse;
            if (redditoNettoPrimaDiINPS > sogliaInpsEccedenza) {
                inpsEccedenza = (redditoNettoPrimaDiINPS - sogliaInpsEccedenza) * (aliquotaInpsEccedenza / 100);
            }
        }

        // Calcola il reddito netto finale
        const redditoNetto = redditoImponibile - tasse - inps - inpsEccedenza;

        // Aggiorna i risultati nella tabella
        document.getElementById('reddito-imponibile').textContent = redditoImponibile.toFixed(2);
        document.getElementById('tasse').textContent = tasse.toFixed(2);
        document.getElementById('inps').textContent = inps.toFixed(2);
        document.getElementById('inps-eccedenza').textContent = inpsEccedenza.toFixed(2);
        document.getElementById('reddito-netto').textContent = redditoNetto.toFixed(2);
    }

    // Esegui il calcolo iniziale
    aggiornaModalitaINPS();
</script>

</body>
</html>
